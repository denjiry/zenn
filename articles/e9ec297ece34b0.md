---
title: "Leanã‚’æ›¸ã„ã¦ã‚‹æœ€ä¸­ã«ã‚·ã‚§ãƒ«ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã‚’ä½œã‚‹"
emoji: "ðŸ’²"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [lean, lean4]
publication_name: labbase
published: false
---

æœ¬è¨˜äº‹ã¯LabBase ãƒ†ãƒƒã‚¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ Advent Calendar 2024 19 æ—¥ç›®ã§ã™ã€‚

https://qiita.com/advent-calendar/2024/labbase


# æ¦‚è¦ #

Leanã¯é–¢æ•°åž‹ãƒ‘ãƒ©ãƒ€ã‚¤ãƒ ã‚’æŒã¡ãªãŠã‹ã¤å®šç†è¨¼æ˜Žæ”¯æ´ç³»ã§ã€å¼·åŠ›ãªãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’ããªãˆãŸã¨ã„ã†å¤‰ã‚ã£ãŸè¨€èªžã§ã™ã€‚
æœ¬è¨˜äº‹ã§ã¯Leanã‚’æ›¸ã„ã¦ã„ã‚‹æœ€ä¸­ã«ã‚‚ã‚·ã‚§ãƒ«ã‚’å©ã‘ã‚‹ã‚ˆã†ã«ã€Leanã®ãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®Elaborationã‚’ã¤ã‹ã£ã¦ã€Leanã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å†…ã§ä½¿ãˆã‚‹ç°¡å˜ãªã‚³ãƒžãƒ³ãƒ‰ã‚’è‡ªä½œã—ã¾ã™ã€‚

# Elaborationã¨ã¯ #

Leanã¯æ™®é€šã®é–¢æ•°åž‹è¨€èªžã§ã‚ã‚Šã€ãªãŠã‹ã¤å®šç†è¨¼æ˜Žæ”¯æ´ç³»ã§ã‚‚ã‚ã‚‹å¤§å¤‰ãƒ‘ãƒ¯ãƒ•ãƒ«ãªè¨€èªžã§ã™ã€‚
ä»Šå›žä½¿ç”¨ã™ã‚‹Elaborationã¨ã„ã†æ©Ÿèƒ½ã¯Leanã®ãƒ‘ãƒ¯ãƒ•ãƒ«ã•ã®æºã«ãªã£ã¦ã„ã‚‹æ©Ÿèƒ½ã§ã€è¦ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®æ©Ÿèƒ½ã‚’ãã®ã¾ã¾è‡ªç”±ã«ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚ï¼ˆå®Ÿã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒæ–‡æ³•ã«æ„å‘³ã‚’ä¸Žãˆã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã¯Elaborationãã®ã‚‚ã®ã§ã™ï¼‰
ä»Šå›žã¤ã‹ã†ã‚³ãƒžãƒ³ãƒ‰ã®Elaborationã®ä»–ã«ã€ã‚¿ã‚¯ãƒ†ã‚£ã‚¯ç”¨ã€termç”¨ã®ElaborationãŒã‚ã‚Šã¾ã™ãŒã€ä»Šå›žã¯ã‚³ãƒžãƒ³ãƒ‰ã®Elaborationã‚’ä½¿ã„ã¾ã™ã€‚

# "hello!"ã ã‘å‡ºåŠ›ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ #

å‰æº–å‚™ã¨ã—ã¦helloã ã‘å‡ºåŠ›ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã‚’å®šç¾©ã—ã¾ã™ã€‚


``` lean
import Lean
open Lean Elab

elab "#hello" : command => do
  logInfo "hello!"
```
`import`ã€`open`ã¯Elaborationç”¨ã®æ¨™æº–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸`Elab`ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã§ã™ã€‚æ–°ã—ãElaborationã‚’å®šç¾©ã™ã‚‹ã¨ãã¯ã€ã“ã‚Œã‚‰ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚ã‚‹`elab`ã‚³ãƒžãƒ³ãƒ‰ã‚’ä½¿ã£ã¦å®šç¾©ã—ã¾ã™ã€‚

`"#hello"`ã¯ä»Šå›žã¤ãã‚‹ã‚³ãƒžãƒ³ãƒ‰ã®åå‰ã§ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«æ›¸ãå®Ÿä½“ã¯ã“ã‚Œã§ã™ã€‚ã¾ãŸä»Šå›žã¯ã‚³ãƒžãƒ³ãƒ‰ã®Elaborationãªã®ã§`: command`ã«ã‚ˆã£ã¦ã‚³ãƒžãƒ³ãƒ‰ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚

`logInfo`ã¯Leanã‚’æ›¸ã„ã¦ã„ã‚‹æœ€ä¸­ã«ã„ã¤ã§ã‚‚è¦‹ã‚Œã‚‹Info viewã«ã€ãƒ­ã‚°ã¨ã—ã¦æ–‡å­—åˆ—ã‚’å‡ºåŠ›ã§ãã‚‹é–¢æ•°ã§ã™ã€‚

ã“ã®ã‚ˆã†ã«å®šç¾©ã—ãŸã‚³ãƒžãƒ³ãƒ‰`#hello`ã¯ã€å®šç¾©ã—ãŸå ´æ‰€ä»¥é™ã«ãã®ã¾ã¾æ›¸ãã“ã¨ã§ä½¿ç”¨ã§ãã¾ã™ã€‚
ï¼ˆLeanã§ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ã®ã‚ˆã†ãªCLIã®å¯¾è©±ç’°å¢ƒã®ä»£ã‚ã‚Šã«ã€å¯¾è©±çš„ã«ä½¿ãˆã‚‹è£œåŠ©ã‚³ãƒžãƒ³ãƒ‰ã¨ã€å®šç¾©ã•ã‚ŒãŸå¤‰æ•°ã‚„é–¢æ•°ãƒ»ãƒ­ã‚°ãªã©ã®æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹info viewï¼ˆãŠã‚ˆã³è¨€èªžã‚µãƒ¼ãƒãƒ¼ï¼‰ã«ã‚ˆã£ã¦é–‹ç™ºã§ãã¾ã™ã€‚æ‰‹è»½ã•çš„ã«ã¯Jupyter Notebookãªã©ã«è¿‘ã„ã§ã™ï¼‰

``` lean: #helloã®å®šç¾©ã¨ä½¿ç”¨æ–¹æ³•
import Lean
open Lean Elab

elab "#hello" : command => do
  logInfo "hello!"

#hello

-- info viewã«ãƒ­ã‚°ã¨ã—ã¦ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹

hello!

```

# `ls -l`ã®å®Ÿè¡Œçµæžœã‚’å‡ºåŠ›ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ #

æ¬¡ã«`ls -l`ã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã‚’ã¤ãã£ã¦ã„ãã¾ã™ã€‚


``` lean: #shell_lsã®å®šç¾©
import Lean
open Lean Elab

elab "#shell_ls" : command => do
  let spawn_args: IO.Process.SpawnArgs := {cmd := "ls", args := #["-l"]}
  let output <- IO.Process.output spawn_args
  logInfo output.stdout
```

å…ˆç¨‹ã¯`logInfo "hello!"`ã ã‘ã ã£ãŸ`elab`ã®ä¸­èº«ã«ã€å­ãƒ—ãƒ­ã‚»ã‚¹ã®å®Ÿè¡Œã¨ãã®æ¨™æº–å‡ºåŠ›ã®è¡¨ç¤ºãŒåŠ ã‚ã‚Šã¾ã—ãŸã€‚

`IO.Process.SpawnArgs`ã¯å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å®Ÿè¡Œã—ãŸã„ã‚·ã‚§ãƒ«ã‚³ãƒžãƒ³ãƒ‰ã‚’è¡¨ã™æ§‹é€ ä½“ã§ã‚ã‚Šã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚·ã‚§ãƒ«ã‚³ãƒžãƒ³ãƒ‰ã‚’æ–‡å­—åˆ—ã¨ã—ã¦ä¿æŒã™ã‚‹`cmd`ã¨ã€ç¶šãå¼•æ•°ã®`args`ã‚’æŒã¡ã¾ã™ã€‚
ãªã®ã§`{cmd := "ls", args := #["-l"]}`ã®ã‚ˆã†ã«å®šç¾©ã—ã¦`spawn_args`ã«æŸç¸›ã—ã¾ã™ã€‚

`IO.Process.output`ã¯`IO.Process.SpawnArgs`ã‚’å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å®Ÿéš›ã«å®Ÿè¡Œã™ã‚‹é–¢æ•°ã§ã€å­ãƒ—ãƒ­ã‚»ã‚¹ã®å®Ÿè¡Œçµæžœã‚’outputã«æŸç¸›ã—ã¾ã™ã€‚
ã‚ã¨ã¯`logInfo output.stdout`ã§å®Ÿè¡Œçµæžœã®æ¨™æº–å‡ºåŠ›ã‚’ãƒ­ã‚°ã«è¡¨ç¤ºã•ã›ã‚Œã°ã€`ls -l`ã®å®Ÿè¡Œçµæžœã‚’å‡ºåŠ›ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã®å®Œæˆã§ã™ã€‚

`#hello`ã¨åŒæ§˜ã€å®šç¾©ã—ãŸå ´æ‰€ä»¥é™ã«æ›¸ãã“ã¨ã§ä½¿ç”¨ã§ãã¾ã™ã€‚

``` lean: #shell_ls
#shell_ls

-- info viewã«ãƒ­ã‚°ã¨ã—ã¦ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹

Messages below (5)
43:0:
åˆè¨ˆ 28
drwxrwxr-x 2 denjiry denjiry 4096  9æœˆ 30 13:58 LightblueLean
-rw-rw-r-- 1 denjiry denjiry  161 12æœˆ  1 15:50 LightblueLean.lean
-rw-rw-r-- 1 denjiry denjiry   77  9æœˆ 30 03:46 Main.lean
-rw-rw-r-- 1 denjiry denjiry   16  9æœˆ 30 03:46 README.md
-rw-rw-r-- 1 denjiry denjiry  124  9æœˆ 30 13:54 lake-manifest.json
-rw-rw-r-- 1 denjiry denjiry  247  9æœˆ 30 03:46 lakefile.lean
-rw-rw-r-- 1 denjiry denjiry   24  9æœˆ 30 03:46 lean-toolchain
```

ã“ã®ã‚ˆã†ã«ã€`ls -l`ã‚’å®Ÿè¡Œã—ãŸçµæžœã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚



# ä»»æ„ã®ã‚·ã‚§ãƒ«ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ #

æœ€å¾Œã«ä»»æ„ã®ã‚·ã‚§ãƒ«ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã‚’ä½œã‚Šã¾ã™ã€‚

`#shell "wc" "README.md"`

ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã€`#shell`ã‚³ãƒžãƒ³ãƒ‰ã®ã‚ã¨ã«ã‚·ã‚§ãƒ«ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’ç¶šã‘ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚


``` lean: #shellã®å®šç¾©
import Lean
open Lean Elab

elab "#shell" s:str+ : command => do
  let cmds := s.map TSyntax.getString
  let (cmd, args) := (cmds[0]!, cmds[1:])
  let cmd: IO.Process.SpawnArgs := {cmd, args}
  let output <- IO.Process.output cmd
  logInfo output.stdout
```

`#shell_ls`ã®ã‚³ãƒ¼ãƒ‰ã«æ–°ãŸã«`s:str+`ãŒåŠ ã‚ã‚Šã¾ã—ãŸã€‚
`str+`ã¯æ­£è¦è¡¨ç¾ã§`+`ãŒï¼‘å€‹ä»¥ä¸Šã®ç¹°ã‚Šè¿”ã—ã‚’è¡¨ã™ã®ã¨ä¼¼ã¦ã„ã¦ã€ã€Œï¼‘å€‹ä»¥ä¸Šã®é€£ç¶šã™ã‚‹æ–‡å­—åˆ—ã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚
ã™ãªã‚ã¡`s:str+`ã¯ã€Œï¼‘å€‹ä»¥ä¸Šã®é€£ç¶šã™ã‚‹æ–‡å­—åˆ—ã‚’`s`ã«æŸç¸›ã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã«ãªã‚Šã€ã“ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ãã¯`#shell`ã«ç¶šã‘ã¦æ–‡å­—åˆ—ã‚’ï¼‘å€‹ä»¥ä¸Šé€£ç¶šã—ã¦ç¶šã‘ã‚‹ã¨ã„ã†å½¢ã«ãªã‚Šã¾ã™ã€‚

å®Ÿéš›ã«`#shell`ã§`wc`ã‚’ã¤ã‹ã£ã¦README.mdã®æ–‡å­—æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¦ã¿ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

``` lean: #shell wc README.md
#shell "wc" "README.md"

-- info viewã«ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹

Messages below (5)
56:0: 
 0  2 16 README.md
```

ã¾ãŸ`ls -l`ãªã©ã€ä»–ã®ã‚·ã‚§ãƒ«ã‚³ãƒžãƒ³ãƒ‰ã‚‚åŒæ§˜ã«å‹•ãã¾ã™ã€‚


``` lean: #shell ls -l
#shell "ls" "-l"

-- info viewã«ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹

Messages below (5)
43:0:
åˆè¨ˆ 28
drwxrwxr-x 2 denjiry denjiry 4096  9æœˆ 30 13:58 LightblueLean
-rw-rw-r-- 1 denjiry denjiry  161 12æœˆ  1 15:50 LightblueLean.lean
-rw-rw-r-- 1 denjiry denjiry   77  9æœˆ 30 03:46 Main.lean
-rw-rw-r-- 1 denjiry denjiry   16  9æœˆ 30 03:46 README.md
-rw-rw-r-- 1 denjiry denjiry  124  9æœˆ 30 13:54 lake-manifest.json
-rw-rw-r-- 1 denjiry denjiry  247  9æœˆ 30 03:46 lakefile.lean
-rw-rw-r-- 1 denjiry denjiry   24  9æœˆ 30 03:46 lean-toolchain
```

# ãŠã‚ã‚Šã« #

æœ¬è¨˜äº‹ã§ã¯Leanã®å¼·åŠ›ãªæ©Ÿèƒ½ã§ã‚ã‚‹Elaborationã‚’ç´¹ä»‹ã—ã€å­ãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã‚’ã©ã†ã‚„ã£ã¦å®šç¾©ã™ã‚‹ã‹ã«ã¤ã„ã¦ã€é †ã‚’è¿½ã£ã¦è§£èª¬ã—ã¾ã—ãŸã€‚
ä»Šå›žã¯IOã®å‰¯ä½œç”¨ãŒå®Ÿè¡Œå¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ã¦ã€å­ãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã‚’å®šç¾©ã—ã¾ã—ãŸã€‚
ã—ã‹ã—Elaborationã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨€èªžè‡ªä½“ã¸è‡ªç”±ã«ä»‹å…¥ã™ã‚‹ã“ã¨ãŒã§ãã‚‹æ©Ÿèƒ½ã§ã‚ã‚Šã€ä»Šå›žã¯ç´¹ä»‹ã§ãã¾ã›ã‚“ã§ã—ãŸãŒã€IOã®å‰¯ä½œç”¨ä»¥å¤–ã«ã‚‚ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒç®¡ç†ã—ã¦ã„ã‚‹æ§˜ã€…ãªæƒ…å ±ï¼ˆå®šç¾©ã•ã‚Œã¦ã„ã‚‹å¤‰æ•°ã‚„ä»–ã®ã‚³ãƒžãƒ³ãƒ‰ãªã©ï¼‰ã®èª­ã¿æ›¸ãã®å‰¯ä½œç”¨ã‚’æ‰±ã†ã“ã¨ãŒã§ãã¾ã™ã€‚
ã—ãŸãŒã£ã¦è¨€èªžã«é–¢ã—ã¦æƒ³åƒã§ãã‚‹ã‚ˆã†ãªã“ã¨ã¯ã€ï¼ˆæ°—åˆãŒã‚ã‚Œã°ï¼‰ãªã‚“ã§ã‚‚ã§ãã¦ã—ã¾ã†è¨€èªžã¨ãªã£ã¦ã„ã¾ã™ã€‚

æœ€è¿‘ã¯æœ‰å¿—ã®æ–¹ã®ãŠã‹ã’ã§æ—¥æœ¬èªžè³‡æ–™ã‚‚èª­ã‚ã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã€èˆˆå‘³ã®ã‚ã„ãŸæ–¹ã¯æ–°ã—ã„ãƒ‘ãƒ©ãƒ€ã‚¤ãƒ ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªžã¨ã—ã¦Leanã‚’å‹‰å¼·ã—ã¦ã¿ã‚‹ã®ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹

# å‚è€ƒ #

https://lean-ja.github.io/lean4-metaprogramming-book-ja/main/07_elaboration.html

https://lean-ja.github.io/fp-lean-ja/type-classes/indexing.html

https://lean-ja.github.io/lean-by-example/Reference/Type/List.html
