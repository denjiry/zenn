---
title: "Leanã‚’æ›¸ã„ã¦ã‚‹æœ€ä¸­ã«ã‚·ã‚§ãƒ«ã®ã‚³ãƒžãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã‚’ä½œã‚‹"
emoji: "ðŸ’²"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [lean, lean4]
publication_name: labbase
published: false
---

æœ¬è¨˜äº‹ã¯LabBase ãƒ†ãƒƒã‚¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ Advent Calendar 2024 19 æ—¥ç›®ã§ã™ã€‚

https://qiita.com/advent-calendar/2024/labbase


# æ¦‚è¦ #

Leanã¯é–¢æ•°åž‹ãƒ‘ãƒ©ãƒ€ã‚¤ãƒ ã‚’æŒã¡ãªãŠã‹ã¤å®šç†è¨¼æ˜Žæ”¯æ´ç³»ã§ã€å¼·åŠ›ãªãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã‚’æŒã¤ã¨ã„ã†å¤‰ã‚ã£ãŸæ€§è³ªã‚’æŒã¡ã¾ã™ã€‚
æœ¬è¨˜äº‹ã§ã¯Leanã‚’æ›¸ã„ã¦ã„ã‚‹æœ€ä¸­ã«ã‚‚ã‚·ã‚§ãƒ«ã‚’å©ã‘ã‚‹ã‚ˆã†ã«ã€ãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ©Ÿèƒ½ã®Elaborationã‚’ã¤ã‹ã£ã¦ã€Leanã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å†…ã§ä½¿ãˆã‚‹ç°¡å˜ãªã‚³ãƒžãƒ³ãƒ‰ã‚’è‡ªä½œã—ã¾ã™ã€‚

# Elaborationã¨ã¯ #

Leanã¯æ™®é€šã®é–¢æ•°åž‹è¨€èªžã§ã‚ã‚Šã€ãªãŠã‹ã¤å®šç†è¨¼æ˜Žæ”¯æ´ç³»ã§ã‚‚ã‚ã‚‹å¤§å¤‰ãƒ‘ãƒ¯ãƒ•ãƒ«ãªè¨€èªžã§ã™ã€‚
ä»Šå›žä½¿ç”¨ã™ã‚‹Elaborationã¨ã„ã†æ©Ÿèƒ½ã¯Leanã®ãƒ‘ãƒ¯ãƒ•ãƒ«ã•ã®æºã«ãªã£ã¦ã„ã‚‹æ©Ÿèƒ½ã§ã€è¦ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®æ©Ÿèƒ½ã‚’ãã®ã¾ã¾è‡ªç”±ã«ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚ï¼ˆå®Ÿã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒæ–‡æ³•ã«æ„å‘³ã‚’ä¸Žãˆã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã¯Elaborationãã®ã‚‚ã®ã§ã™ï¼‰
ä»Šå›žã¤ã‹ã†ã‚³ãƒžãƒ³ãƒ‰ã®Elaborationã®ä»–ã«ã€ã‚¿ã‚¯ãƒ†ã‚£ã‚¯ç”¨ã€termç”¨ã®ElaborationãŒã‚ã‚Šã¾ã™ãŒã€ä»Šå›žã¯ã‚³ãƒžãƒ³ãƒ‰ã®Elaborationã®ã¿ã‚’ä½¿ã„ã¾ã™ã€‚


# hello!ã ã‘å‡ºåŠ›ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ #

å‰æº–å‚™ã¨ã—ã¦helloã ã‘å‡ºåŠ›ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã‚’å®šç¾©ã—ã¾ã™ã€‚


``` lean
import Lean
open Lean Elab

elab "#hello" : command => do
  logInfo "hello!"
```
importã€openã¯Elaborationç”¨ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã§ã™ã€‚æ–°ã—ãElaborationã‚’å®šç¾©ã™ã‚‹ã¨ãã¯ã€ã“ã‚Œã‚‰ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã‚ã‚‹elabã‚³ãƒžãƒ³ãƒ‰ã«ã‚ˆã£ã¦å®šç¾©ã—ã¾ã™ã€‚

"#hello"ã¯ä»Šå›žã¤ãã‚‹ã‚³ãƒžãƒ³ãƒ‰ã®åå‰ã§ã€ã¾ãŸä»Šå›žã¯ã‚³ãƒžãƒ³ãƒ‰ã®Elaborationãªã®ã§: commandã«ã‚ˆã£ã¦ã‚³ãƒžãƒ³ãƒ‰ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚

logInfoã¯Leanã‚’æ›¸ã„ã¦ã„ã‚‹æœ€ä¸­ã«ã„ã¤ã§ã‚‚è¦‹ã‚Œã‚‹Infoãƒ‘ãƒãƒ«ã«ãƒ­ã‚°ã¨ã—ã¦æ–‡å­—åˆ—ã‚’å‡ºåŠ›ã™ã‚‹é–¢æ•°ã§ã™ã€‚

ã“ã®ã‚ˆã†ã«å®šç¾©ã—ãŸã‚³ãƒžãƒ³ãƒ‰#helloã¯ã€å®šç¾©ã—ãŸå ´æ‰€ä»¥é™ã«æ›¸ãã“ã¨ã§ä½¿ç”¨ã§ãã¾ã™ã€‚

``` lean
import Lean
open Lean Elab

elab "#hello" : command => do
  logInfo "hello!"

#hello

-- infoãƒ‘ãƒãƒ«ã«ãƒ­ã‚°ã¨ã—ã¦ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹

hello!

```

# ls -lã®å®Ÿè¡Œçµæžœã‚’å‡ºåŠ›ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ #

æ¬¡ã«ls -lã‚’å®Ÿè¡Œã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã‚’ã¤ãã£ã¦ã„ãã¾ã™ã€‚


``` lean
import Lean
open Lean Elab

elab "#shell_ls" : command => do
  let spawn_args: IO.Process.SpawnArgs := {cmd := "ls", args := #["-l"]}
  let output <- IO.Process.output spawn_args
  logInfo output.stdout
```

å…ˆç¨‹ã¯`logInfo "hello!"`ã ã‘ã ã£ãŸ`elab`ã®ä¸­èº«ã«ã€å­ãƒ—ãƒ­ã‚»ã‚¹ã®å®Ÿè¡Œã¨ãã®æ¨™æº–å‡ºåŠ›ã®è¡¨ç¤ºãŒåŠ ã‚ã‚Šã¾ã—ãŸã€‚

`IO.Process.SpawnArgs`ã¯å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å®Ÿè¡Œã—ãŸã„ã‚·ã‚§ãƒ«ã‚³ãƒžãƒ³ãƒ‰ã‚’è¡¨ã™æ§‹é€ ä½“ã§ã‚ã‚Šã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚·ã‚§ãƒ«ã‚³ãƒžãƒ³ãƒ‰ã®`cmd`ã¨ç¶šãå¼•æ•°ã®`args`ã‚’æŒã¡ã¾ã™ã€‚
ãªã®ã§`{cmd := "ls", args := #["-l"]}`ã®ã‚ˆã†ã«å®šç¾©ã—ã¦`spawn_args`ã«æŸç¸›ã—ã¾ã™ã€‚

`IO.Process.output`ã¯`IO.Process.SpawnArgs`ã‚’å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å®Ÿéš›ã«å®Ÿè¡Œã™ã‚‹é–¢æ•°ã§ã€å­ãƒ—ãƒ­ã‚»ã‚¹ã®å®Ÿè¡Œçµæžœã‚’outputã«æŸç¸›ã—ã¾ã™ã€‚
ã‚ã¨ã¯`logInfo output.stdout`ã§å®Ÿè¡Œçµæžœã®æ¨™æº–å‡ºåŠ›ã‚’ãƒ­ã‚°ã«è¡¨ç¤ºã•ã›ã‚Œã°ã€ls -lã®å®Ÿè¡Œçµæžœã‚’å‡ºåŠ›ã™ã‚‹ã‚³ãƒžãƒ³ãƒ‰ã®å®Œæˆã§ã™ã€‚


``` lean
#shell_ls

-- infoãƒ‘ãƒãƒ«ã«ãƒ­ã‚°ã¨ã—ã¦ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹

Messages below (5)
43:0:
åˆè¨ˆ 28
drwxrwxr-x 2 denjiry denjiry 4096  9æœˆ 30 13:58 LightblueLean
-rw-rw-r-- 1 denjiry denjiry  161 12æœˆ  1 15:50 LightblueLean.lean
-rw-rw-r-- 1 denjiry denjiry   77  9æœˆ 30 03:46 Main.lean
-rw-rw-r-- 1 denjiry denjiry   16  9æœˆ 30 03:46 README.md
-rw-rw-r-- 1 denjiry denjiry  124  9æœˆ 30 13:54 lake-manifest.json
-rw-rw-r-- 1 denjiry denjiry  247  9æœˆ 30 03:46 lakefile.lean
-rw-rw-r-- 1 denjiry denjiry   24  9æœˆ 30 03:46 lean-toolchain

```




``` lean
import Lean
open Lean Elab

elab "#shell" s:str+ : command => do
  let cmds := s.map TSyntax.getString
  if cmds.size < 1 then
    throwUnsupportedSyntax
  let (cmd, args) := (cmds[0]!, cmds[1:])
  let cmd: IO.Process.SpawnArgs := {cmd, args}
  let output <- IO.Process.output cmd
  logInfo output.stdout


```


``` lean
#shell "ls" "-l"

-- infoãƒ‘ãƒãƒ«ã«ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹

Messages below (5)
43:0:
åˆè¨ˆ 28
drwxrwxr-x 2 denjiry denjiry 4096  9æœˆ 30 13:58 LightblueLean
-rw-rw-r-- 1 denjiry denjiry  161 12æœˆ  1 15:50 LightblueLean.lean
-rw-rw-r-- 1 denjiry denjiry   77  9æœˆ 30 03:46 Main.lean
-rw-rw-r-- 1 denjiry denjiry   16  9æœˆ 30 03:46 README.md
-rw-rw-r-- 1 denjiry denjiry  124  9æœˆ 30 13:54 lake-manifest.json
-rw-rw-r-- 1 denjiry denjiry  247  9æœˆ 30 03:46 lakefile.lean
-rw-rw-r-- 1 denjiry denjiry   24  9æœˆ 30 03:46 lean-toolchain

```
